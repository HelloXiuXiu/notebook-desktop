var f=Object.defineProperty;var h=(d,t)=>f(d,"name",{value:t,configurable:!0});class c{constructor(t,e,r){this.isTonicTemplate=!0,this.unsafe=r,this.rawText=t,this.templateStrings=e}valueOf(){return this.rawText}toString(){return this.rawText}}h(c,"TonicTemplate");export class Tonic extends window.HTMLElement{static _tags="";static _refIds=[];static _data={};static _states={};static _children={};static _reg={};static _stylesheetRegistry=[];static _index=0;static get version(){return"15.1.1"}static get SPREAD(){return/\.\.\.\s?(__\w+__\w+__)/g}static get ESC(){return/["&'<>`/]/g}static get AsyncFunctionGenerator(){return async function*(){}.constructor}static get AsyncFunction(){return async function(){}.constructor}static get MAP(){return{'"':"&quot;","&":"&amp;","'":"&#x27;","<":"&lt;",">":"&gt;","`":"&#x60;","/":"&#x2F;"}}constructor(){super();const t=Tonic._states[super.id];delete Tonic._states[super.id],this._state=t||{},this.preventRenderOnReconnect=!1,this.props={},this.elements=[...this.children],this.elements.__children__=!0,this.nodes=[...this.childNodes],this.nodes.__children__=!0,this._events()}get isTonicComponent(){return!0}static _createId(){return`tonic${Tonic._index++}`}static _normalizeAttrs(t,e={}){return[...t].forEach(r=>e[r.name]=r.value),e}_checkId(){const t=super.id;if(!t){const e=this.outerHTML.replace(this.innerHTML,"...");throw new Error(`Component: ${e} has no id`)}return t}get state(){return this._checkId(),this._state}set state(t){this._state=(this._checkId(),t)}_events(){const t=Object.getOwnPropertyNames(window.HTMLElement.prototype);for(const e of this._props)t.indexOf("on"+e)!==-1&&this.addEventListener(e,this)}_prop(t){const e=this._id,r=`__${e}__${Tonic._createId()}__`;return Tonic._data[e]=Tonic._data[e]||{},Tonic._data[e][r]=t,r}_placehold(t){const e=this._id,r=`placehold:${e}:${Tonic._createId()}__`;return Tonic._children[e]=Tonic._children[e]||{},Tonic._children[e][r]=t,r}static match(t,e){return t.matches||(t=t.parentElement),t.matches(e)?t:t.closest(e)}static getTagName(t){return t.match(/[A-Z][a-z0-9]*/g).join("-").toLowerCase()}static getPropertyNames(t){const e=[];for(;t&&t!==Tonic.prototype;)e.push(...Object.getOwnPropertyNames(t)),t=Object.getPrototypeOf(t);return e}static add(t,e){if(!(e||t.name&&t.name.length>1))throw Error("Mangling. https://bit.ly/2TkJ6zP");if(e||(e=Tonic.getTagName(t.name)),!Tonic.ssr&&window.customElements.get(e))throw new Error(`Cannot Tonic.add(${t.name}, '${e}') twice`);if(!t.prototype||!t.prototype.isTonicComponent){const n={[t.name]:class extends Tonic{}}[t.name];n.prototype.render=t,t=n}return t.prototype._props=Tonic.getPropertyNames(t.prototype),Tonic._reg[e]=t,Tonic._tags=Object.keys(Tonic._reg).join(),window.customElements.define(e,t),typeof t.stylesheet=="function"&&Tonic.registerStyles(t.stylesheet),t}static registerStyles(t){if(Tonic._stylesheetRegistry.includes(t))return;Tonic._stylesheetRegistry.push(t);const e=document.createElement("style");Tonic.nonce&&e.setAttribute("nonce",Tonic.nonce),e.appendChild(document.createTextNode(t())),document.head&&document.head.appendChild(e)}static escape(t){return t.replace(Tonic.ESC,e=>Tonic.MAP[e])}static unsafeRawString(t,e){return new c(t,e,!0)}dispatch(t,e=null){const r={bubbles:!0,detail:e};this.dispatchEvent(new window.CustomEvent(t,r))}html(t,...e){const r=h(s=>{if(s&&s.__children__)return this._placehold(s);if(s&&s.isTonicTemplate)return s.rawText;switch(Object.prototype.toString.call(s)){case"[object HTMLCollection]":case"[object NodeList]":return this._placehold([...s]);case"[object Array]":return s.every(o=>o.isTonicTemplate&&!o.unsafe)?new c(s.join(`
`),null,!1):this._prop(s);case"[object Object]":case"[object Function]":case"[object Set]":case"[object Map]":case"[object WeakMap]":return this._prop(s);case"[object NamedNodeMap]":return this._prop(Tonic._normalizeAttrs(s));case"[object Number]":return`${s}__float`;case"[object String]":return Tonic.escape(s);case"[object Boolean]":return`${s}__boolean`;case"[object Null]":return`${s}__null`;case"[object HTMLElement]":return this._placehold([s])}return typeof s=="object"&&s&&s.nodeType===1&&typeof s.cloneNode=="function"?this._placehold([s]):s},"refs"),n=[];for(let s=0;s<t.length-1;s++)n.push(t[s],r(e[s]));n.push(t[t.length-1]);const i=n.join("").replace(Tonic.SPREAD,(s,o)=>{const a=Tonic._data[o.split("__")[1]][o];return Object.entries(a).map(([u,l])=>{const p=u.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return l===!0?p:l?`${p}="${Tonic.escape(String(l))}"`:""}).filter(Boolean).join(" ")});return new c(i,t,!1)}scheduleReRender(t){return this.pendingReRender?this.pendingReRender:(this.pendingReRender=new Promise(e=>setTimeout(()=>{if(!this.isInDocument(this.shadowRoot||this))return;const r=this._set(this.shadowRoot||this,this.render);if(this.pendingReRender=null,r&&r.then)return r.then(()=>{this.updated&&this.updated(t),e(this)});this.updated&&this.updated(t),e(this)},0)),this.pendingReRender)}reRender(t=this.props){const e={...this.props};return this.props=typeof t=="function"?t(e):t,this.scheduleReRender(e)}handleEvent(t){this[t.type](t)}_drainIterator(t,e){return e.next().then(r=>{if(this._set(t,null,r.value),!r.done)return this._drainIterator(t,e)})}_set(t,e,r=""){this.willRender&&this.willRender();for(const n of t.querySelectorAll(Tonic._tags)){if(!n.isTonicComponent)continue;const i=n.getAttribute("id");!i||!Tonic._refIds.includes(i)||(Tonic._states[i]=n.state)}if(e instanceof Tonic.AsyncFunction)return e.call(this,this.html,this.props).then(n=>this._apply(t,n));if(e instanceof Tonic.AsyncFunctionGenerator)return this._drainIterator(t,e.call(this));e===null?this._apply(t,r):e instanceof Function&&this._apply(t,e.call(this,this.html,this.props)||"")}_apply(t,e){if(e&&e.isTonicTemplate?e=e.rawText:typeof e=="string"&&(e=Tonic.escape(e)),typeof e=="string"){if(this.stylesheet&&(e=`<style nonce=${Tonic.nonce||""}>${this.stylesheet()}</style>${e}`),t.innerHTML=e,this.styles){const i=this.styles();for(const s of t.querySelectorAll("[styles]"))for(const o of s.getAttribute("styles").split(/\s+/))Object.assign(s.style,i[o.trim()])}const r=Tonic._children[this._id]||{},n=h((i,s)=>{if(i.nodeType===3){const a=i.textContent.trim();r[a]&&s(i,r[a],a)}const o=i.childNodes;if(o)for(let a=0;a<o.length;a++)n(o[a],s)},"walk");n(t,(i,s,o)=>{for(const a of s)i.parentNode.insertBefore(a,i);delete Tonic._children[this._id][o],i.parentNode.removeChild(i)})}else t.innerHTML="",t.appendChild(e.cloneNode(!0))}connectedCallback(){this.root=this.shadowRoot||this,super.id&&!Tonic._refIds.includes(super.id)&&Tonic._refIds.push(super.id);const t=h(e=>e.replace(/-(.)/g,(r,n)=>n.toUpperCase()),"cc");for(const{name:e,value:r}of this.attributes){const n=t(e),i=this.props[n]=r;if(/__\w+__\w+__/.test(i)){const{1:s}=i.split("__");this.props[n]=Tonic._data[s][i]}else if(/\d+__float/.test(i))this.props[n]=parseFloat(i,10);else if(i==="null__null")this.props[n]=null;else if(/\w+__boolean/.test(i))this.props[n]=i.includes("true");else if(/placehold:\w+:\w+__/.test(i)){const{1:s}=i.split(":");this.props[n]=Tonic._children[s][i][0]}}if(this.props=Object.assign(this.defaults?this.defaults():{},this.props),this._id=this._id||Tonic._createId(),this.willConnect&&this.willConnect(),!!this.isInDocument(this.root)){if(!this.preventRenderOnReconnect){this._source?this.innerHTML=this._source:this._source=this.innerHTML;const e=this._set(this.root,this.render);if(e&&e.then)return e.then(()=>this.connected&&this.connected())}this.connected&&this.connected()}}isInDocument(t){const e=t.getRootNode();return e===document||e.toString()==="[object ShadowRoot]"}disconnectedCallback(){this.disconnected&&this.disconnected(),delete Tonic._data[this._id],delete Tonic._children[this._id]}}h(Tonic,"Tonic");export default Tonic;
